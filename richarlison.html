<!DOCTYPE html>
<html>
  <head>
    <title>Richarlison Racer</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    
    <script>
      AFRAME.registerComponent('drive-car', {
        init: function () {
          this.speed = 0;
          this.rotationSpeed = 0;
          
          // Escuta quando aperta as teclas
          window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp' || e.key === 'w') this.accelerating = true;
            if (e.key === 'ArrowDown' || e.key === 's') this.braking = true;
            if (e.key === 'ArrowLeft' || e.key === 'a') this.turningLeft = true;
            if (e.key === 'ArrowRight' || e.key === 'd') this.turningRight = true;
          });

          // Escuta quando solta as teclas
          window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowUp' || e.key === 'w') this.accelerating = false;
            if (e.key === 'ArrowDown' || e.key === 's') this.braking = false;
            if (e.key === 'ArrowLeft' || e.key === 'a') this.turningLeft = false;
            if (e.key === 'ArrowRight' || e.key === 'd') this.turningRight = false;
          });
        },

        tick: function (time, timeDelta) {
          const rotation = this.el.getAttribute('rotation');
          const position = this.el.getAttribute('position');
          const delta = timeDelta / 1000; // Tempo em segundos

          // Aceleração
          if (this.accelerating) this.speed -= 10 * delta;
          if (this.braking) this.speed += 10 * delta;

          // Atrito (o carro para sozinho devagar)
          this.speed *= 0.95;

          // Curvas (só vira se estiver andando)
          if (Math.abs(this.speed) > 0.1) {
            if (this.turningLeft) this.rotationSpeed += 50 * delta;
            if (this.turningRight) this.rotationSpeed -= 50 * delta;
          }
          this.rotationSpeed *= 0.90; // Atrito da direção

          // Aplica rotação
          rotation.y += this.rotationSpeed * delta;
          this.el.setAttribute('rotation', rotation);

          // Aplica movimento baseado na rotação
          const angle = rotation.y * (Math.PI / 180);
          position.x += Math.sin(angle) * this.speed * delta;
          position.z += Math.cos(angle) * this.speed * delta;
          
          this.el.setAttribute('position', position);
        }
      });
    </script>

    <a-scene background="color: #ECECEC">
      
      <a-assets>
        <a-asset-item id="modelo-carro" src="./carro.glb"></a-asset-item>
        <img id="grama" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
      </a-assets>

      <a-plane src="#grama" position="0 0 0" rotation="-90 0 0" width="200" height="200" repeat="20 20"></a-plane>
      
      <a-sky color="#87CEEB"></a-sky>

      <a-box position="-5 0.5 -10" color="red"></a-box>
      <a-box position="5 0.5 -20" color="blue"></a-box>
      <a-box position="0 0.5 -40" color="yellow"></a-box>

      <a-entity id="player" position="0 0 0" drive-car>
        
        <a-entity gltf-model="#modelo-carro" scale="1 1 1"></a-entity>

        <a-entity camera position="0 2 5" look-controls="enabled: false"></a-entity>
      
      </a-entity>

    </a-scene>
  </body>
</html>
